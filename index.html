<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ImgBB 上传并显示图片</title>
    <style>
        .container { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        #fileInput { margin: 1rem 0; padding: 0.5rem; }
        #imgPreview { max-width: 100%; margin-top: 1rem; border: 1px solid #eee; display: none; }
        .loading { color: #666; margin: 1rem 0; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>上传图片到 ImgBB 并预览</h1>
        <input type="file" id="fileInput" accept="image/*">
        <div class="loading" id="loading">上传中...</div>
        <img id="imgPreview" alt="预览图">
    </div>

    <script>
        // 1. 替换为你的 ImgBB API Key（必填！）
        const IMGBB_API_KEY = "你的 ImgBB API Key"; 
        // 2. 图片过期时间（可选：1=1分钟，60=1小时，1440=1天，30*1440=30天，0=永久）
        const EXPIRY = 0; 

        const fileInput = document.getElementById("fileInput");
        const imgPreview = document.getElementById("imgPreview");
        const loading = document.getElementById("loading");

        fileInput.addEventListener("change", async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // 校验文件类型（仅图片）
            if (!file.type.startsWith("image/")) {
                alert("请选择图片文件（JPG/PNG/GIF 等）");
                return;
            }

            // 显示加载状态，隐藏之前的预览图
            loading.style.display = "block";
            imgPreview.style.display = "none";

            try {
                // 构造 FormData（ImgBB 要求的提交格式）
                const formData = new FormData();
                formData.append("image", file); // 必传：图片文件
                formData.append("expiration", EXPIRY); // 可选：过期时间
                formData.append("name", file.name); // 可选：图片名称

                // 调用 ImgBB API 上传
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: "POST",
                    body: formData,
                    mode: "cors" // 允许跨域（ImgBB 已支持）
                });

                const result = await response.json();
                console.log("ImgBB 上传结果：", result);

                // 校验上传是否成功
                if (!result.success) {
                    throw new Error(result.error?.message || "上传失败，请重试");
                }

                // 3. 从返回结果中获取 直接可访问的图片 URL（核心修复：使用 display_url 或 url）
                const imageUrl = result.data.display_url || result.data.url; 
                imgPreview.src = imageUrl;
                imgPreview.style.display = "block";
                alert("上传成功！图片地址：" + imageUrl);

            } catch (error) {
                alert("错误：" + error.message);
                console.error("上传失败：", error);
            } finally {
                loading.style.display = "none"; // 隐藏加载状态
            }
        });
    </script>
</body>
</html>
